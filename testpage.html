<body>
<button onclick="connect()" id="btn">Press dis.</button>
<form>
    <input id="textBox" type="text" placeholder="Skriv noe spennende...">
    <button type="submit" onclick="sendStuff()" id="btn">Send til micro:bit</button>
</form>

<div id="resultBox">



</div>


</body>

<script>
//Scanning for device with micro:bit - service

var writeCharacteristic; 
var resultBox = document.getElementById('resultBox');

function connect() {
    navigator.bluetooth.requestDevice({
        acceptAllDevices: true,
        optionalServices: ['6e400001-b5a3-f393-e0a9-e50e24dcca9e']
    
    })
        .then(function(device) {
            resultBox.innerHTML += '<br>Connecting...'
            return device.gatt.connect();
        })

        .then(function(server) {
            resultBox.innerHTML += '<br>Server...'
            return server.getPrimaryService('6e400001-b5a3-f393-e0a9-e50e24dcca9e')
        })

        .then(function(service){
            resultBox.innerHTML += '<br>Service...'
            return service.getCharacteristic('6e400003-b5a3-f393-e0a9-e50e24dcca9e')
        })
        .then(function(characteristic){
            writeCharacteristic = characteristic; 
            var text = 'OK';
            var data = new Uint8Array(toInt(text+':'));
            resultBox.innerHTML += '<br>Writing: ' + text;

            return characteristic.writeValue(data);
        })
        .catch(function(error) {
            console.error('Connection failed!', error);
            resultBox.innerHTML += ('<br>' + alert(error));
        });
}

function sendStuff() {
        var input = document.getElementById('textBox').value;
        var data = new Uint8Array(toInt(input+':'));

        resultBox.innerHTML += '<br>Writing: ' + input;
        return writeCharacteristic.writeValue(data);
}

function toInt(str) {
        var intArray = [];
        for(var i = 0; i<str.length; i++) {
            intArray.push(str.charCodeAt(i));
        }
        return intArray;
}

</script>
